<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Five Queens Jewelry â€” Debug Shop</title>
<style>
body { font-family: Arial; background: #f9f9f9; padding: 20px; }
h1, h2 { text-align: center; }
#products-container { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px; }
.product-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); text-align: center; width: 180px; }
.product-card img { max-width: 100%; border-radius: 8px; margin-bottom: 10px; }
.add-btn { background: #f08a5d; color: white; border: none; border-radius: 6px; padding: 6px 10px; cursor: pointer; }
.add-btn:hover { background: #b83b5e; }
#cart-container { margin-bottom: 20px; }
input, textarea { width: 90%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
button[type="submit"] { padding: 10px 20px; border-radius: 6px; background: #6a2c70; color: white; border: none; cursor: pointer; }
button[type="submit"]:hover { background: #9b59b6; }
</style>
</head>
<body>

<h1>Five Queens Jewelry</h1>
<h2>Products</h2>
<div id="products-container"></div>

<h2>Cart</h2>
<div id="cart-container">Cart is empty</div>
<p>Total: $<span id="cart-total">0</span></p>

<h2>Checkout</h2>
<form id="checkout-form">
  <input type="text" id="customer-name" placeholder="Your Name" required>
  <input type="email" id="customer-email" placeholder="Email" required readonly>
  <input type="text" id="customer-phone" placeholder="Phone" required>
  <textarea id="customer-address" placeholder="Shipping Address" required></textarea>
  <button type="submit">Place Order</button>
</form>

<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// Initialize Supabase
const SUPABASE_URL = "https://iosezfjvavmrlakobzej.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_v023oj_IxpqsRQ7sYPuhkA_EmWJJ22B";
const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Debug log
console.log("Supabase client loaded:", supabase);

let cart = [];

// Default sample products (used if fetch fails)
const sampleProducts = [
  { id:1, name:'Royal Pearl Necklace', price:49.99, image_url:'https://i.imgur.com/5d9xR6t.jpg' },
  { id:2, name:'Elegant Gold Ring', price:29.99, image_url:'https://i.imgur.com/HxL6S9P.jpg' },
  { id:3, name:'Diamond Stud Earrings', price:79.99, image_url:'https://i.imgur.com/ABvZ6YU.jpg' }
];

// Load products from Supabase
async function loadProducts() {
  try {
    const { data, error } = await supabase.from('products').select('*');
    console.log("Products fetch result:", data, error);
    const products = (data && data.length) ? data : sampleProducts;
    renderProducts(products);
  } catch(err) {
    console.error("Fetch failed, using sample products", err);
    renderProducts(sampleProducts);
  }
}

// Render products
function renderProducts(products) {
  const container = document.getElementById('products-container');
  container.innerHTML = '';
  products.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <img src="${p.image_url}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>$${p.price}</p>
      <button class="add-btn">Add to Cart</button>
    `;
    card.querySelector('.add-btn').addEventListener('click', () => {
      cart.push(p);
      updateCart();
    });
    container.appendChild(card);
  });
}

// Update cart display
function updateCart() {
  const container = document.getElementById('cart-container');
  if(cart.length===0){ container.textContent="Cart is empty"; }
  else{ container.innerHTML = cart.map(i=>`${i.name} - $${i.price}`).join('<br>'); }
  document.getElementById('cart-total').textContent = cart.reduce((sum,i)=>sum+parseFloat(i.price),0).toFixed(2);
}

// Auto-fill user info (fake for debug)
function loadUserInfo() {
  document.getElementById('customer-name').value = "Christine";
  document.getElementById('customer-email').value = "lnrdjjmarie@gmail.com";
  document.getElementById('customer-phone').value = "09817829135";
  document.getElementById('customer-address').value = "villa";
}

// Checkout
document.getElementById('checkout-form').addEventListener('submit', e=>{
  e.preventDefault();
  if(cart.length===0){ alert("Cart is empty!"); return; }
  alert(`Order placed! Items:\n${cart.map(i=>i.name).join(", ")}\nTotal: $${cart.reduce((sum,i)=>sum+parseFloat(i.price),0).toFixed(2)}`);
  cart=[];
  updateCart();
  document.getElementById('checkout-form').reset();
  loadUserInfo();
});

document.addEventListener('DOMContentLoaded', ()=>{
  loadProducts();
  loadUserInfo();
});
</script>
</body>
</html>
